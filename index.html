<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>钥匙密码系统</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        .time-info, .password-info, .input-section {
            margin-bottom: 20px;
        }
        .password-info span {
            font-weight: bold;
        }
        input[type="password"] {
            padding: 5px;
            margin-right: 10px;
        }
        button {
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 第一部分：显示当前日期和时间 -->
        <div class="time-info">
            <p id="current-time"></p>
        </div>

        <!-- 第二部分：显示获取时间 -->
        <div class="time-info">
            <p>1.上午7：25和下午13：30后会自动显示钥匙密码。<br>2.中午11：55后手动输入授权码后显示钥匙密码，其他时间输入无用</p>
        </div>

        <!-- 第四部分：显示钥匙密码 -->
        <div class="password-info">
            <span id="password-text">还没到拿钥匙的时间，再等等吧！</span>
        </div>

        <!-- 第五部分：密码输入框 -->
        <div class="input-section">
            <input type="password" id="password-input" placeholder="请输入密码">
            <button onclick="checkPassword()">确定</button>
            <p id="password-result"></p>
        </div>
    </div>

    <script>
        // 获取当前时间并显示
        function updateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            document.getElementById('current-time').innerText = `当前时间：${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

            // 每秒更新时间
            setTimeout(updateTime, 1000);
        }

        // 计算今天是今年的第几天
        function getDayOfYear() {
            const now = new Date();
            const startOfYear = new Date(now.getFullYear(), 0, 0);
            const diff = now - startOfYear;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        // 获取指定索引的数组
        async function getArray(index) {
            const response = await fetch('https://lqlisong.github.io/lqjxmm/sqm.json');
            const data = await response.json();
            return data[index];
        }

        // 更新钥匙密码显示
        function updatePassword() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();

            const dayOfYear = getDayOfYear();
            const newIndex = dayOfYear + 88;

            // 获取a和b
            getArray(newIndex - 1).then(a => {
                if ((hours === 7 && minutes >= 25) || (hours >= 8 && hours < 11) || (hours === 11 && minutes < 30)) {
                    document.getElementById('password-text').innerText = `钥匙密码：${a[0]}`;
                } else if ((hours === 13 && minutes >= 30) || (hours >= 14 && hours < 17) || (hours === 17 && minutes < 30)) {
                    document.getElementById('password-text').innerText = `钥匙密码：${a[1]}`;
                } else {
                    document.getElementById('password-text').innerText = '还没到拿钥匙的时间，再等等吧！';
                }
            });
        }

        // 检查密码
        function checkPassword() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const password = document.getElementById('password-input').value;

            const dayOfYear = getDayOfYear();
            const newIndex = dayOfYear + 88;

            // 获取a和b
            getArray(newIndex - 1).then(a => {
                getArray(newIndex).then(b => {
                    if (password === '0291') {
                        document.getElementById('password-result').innerText = 
                        `今日密码，上午：${a[0]}，下午：${a[1]}\n明日密码，上午：${b[0]}，下午：${b[1]}`;
                    } else if (password === '5431' && ((hours === 11 && minutes >= 55) || (hours === 12) || (hours === 13 && minutes <= 25))) {
                        document.getElementById('password-result').innerText = a[1];
                    } else if (password === '5431') {
                        document.getElementById('password-text').innerText = '11：55到13：25间输入授权码，才能获得钥匙密码';
                    } else {
                        document.getElementById('password-text').innerText = '别瞎试了，试多了网站会拉黑你的，找我也不会给你解的!';
                    }
                });
            });
        }

        // 初始化
        updateTime();
        updatePassword();
        setInterval(updatePassword, 60000); // 每分钟更新一次密码显示
    </script>
</body>
</html>
